---
title: "æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å¯åŠ¨çš„"
date: 2018-07-01T12:21:44+08:00
draft: true
---

èŠ±äº†ä¸€ä¸‹åˆæ—¶é—´ï¼ŒæˆåŠŸå®‰è£…äº† [Arch Linux](https://www.archlinux.org/), æ”¶è·é¢‡ä¸°ã€‚åœ¨æ­¤ä»¥ Arch Linux çš„å®‰è£…ä¸ºä¾‹æ¥èŠä¸€èŠ"æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å¯åŠ¨çš„"ã€‚è™½ç„¶æ˜¯ä»¥ Arch ä¸ºä¾‹ï¼Œä½†å…¶å®æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿéƒ½å¤§åŒå°å¼‚ï¼Œæˆ‘ä¹Ÿä¸æƒ³åˆ—å‡ºæ‰€æœ‰ç³»ç»Ÿçš„è¯¦ç»†å¯åŠ¨æµç¨‹ã€‚

![](images/æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å¯åŠ¨çš„/OS startup process.png)

é¦–å…ˆï¼Œä½ çš„ç”µè„‘æœ‰ä¸€å †ç¡¬ä»¶ï¼ŒCPUã€å†…å­˜ã€ç¡¬ç›˜éƒ½ä¸ä¸»æ¿ç›¸è¿ï¼Œä¸»æ¿ä¸Šæœ‰ [UEFI](https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface) å›ºä»¶ã€‚

## UEFI

UEFI å…¨ç§°æ˜¯ Unified Extensible Firmware Interface, ä¸€ä¸ªç»Ÿä¸€çš„ã€å¯æ‰©å±•çš„ã€ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿä¹‹é—´çš„å›ºä»¶æ¥å£ã€‚å¤§å®¶éƒ½å–œæ¬¢ç»Ÿä¸€ï¼Œ ç»Ÿä¸€æ„å‘³ç€åªéœ€è¦å®ç°ä¸€å¥—æ ‡å‡†ï¼›å¤§å®¶ä¹Ÿéƒ½å–œæ¬¢æ¥å£ï¼Œæ¥å£æŠ½è±¡ç¨‹åº¦é«˜ï¼›å¤§å®¶æ›´å–œæ¬¢å¯æ‰©å±•ï¼Œå¯ä»¥è‡ªå·±æ‰©å±•åŠŸèƒ½ã€‚UEFI æ˜¯ [BIOS](https://en.wikipedia.org/wiki/BIOS) çš„ç»§ä»»è€…ï¼Œè¿‘å‡ å¹´çš„ç”µè„‘éƒ½æ˜¯ä½¿ç”¨ UEFI çš„ã€‚å› ä¸º BIOS å¿…é¡»ä»ç¬¬ä¸€å—ç¡¬ç›˜çš„å‰ 512 Bytes(ç§°ä¸º Master Boot Record) å¼€å§‹åŠ è½½ã€‚å¹¶ä¸”åªæœ‰å‰ 440 Bytes æ˜¯æä¾›ç»™ Bootloader ä¿®æ”¹å®šä¹‰çš„ã€‚ç”±äºç©ºé—´å¤ªå°äº†ï¼Œèƒ½åšçš„äº‹æƒ…å¾ˆæœ‰é™ï¼Œåš Bootloader çš„è¡¨ç¤ºå¿ƒé‡Œè‹¦ã€‚

ä½† UEFI å°±ä¸ä¸€æ ·äº†ï¼ŒUEFI èƒ½è¯†åˆ«æ–‡ä»¶ç³»ç»Ÿï¼Œæ„å‘³ç€ä½ å¯ä»¥æŠŠ Bootloader çš„å¯æ‰§è¡Œæ–‡ä»¶æ”¾åœ¨ç¡¬ç›˜ä¸­çš„ä»»ä½•ä¸€ä¸ªåœ°æ–¹ã€‚å­˜æ”¾ Bootloader å¯æ‰§è¡Œæ–‡ä»¶çš„åœ°æ–¹å«åš [EFI System Partition](https://wiki.archlinux.org/index.php/Unified_Extensible_Firmware_Interface/System_partition), ä¸€èˆ¬ä¸º FAT32 åˆ†åŒºã€‚

## Bootloader

[Bootloader](https://wiki.archlinux.org/index.php/Category:Boot_loaders), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¯åŠ¨åŠ è½½å™¨ã€‚ä½ ç”µè„‘æœ‰å¤šä¸ªæ“ä½œç³»ç»Ÿï¼Œä½ å‘Šè¯‰ Bootloader å»å¯åŠ¨å“ªä¸ªï¼Œå®ƒå°±å»å¯åŠ¨é‚£ä¸ªç³»ç»Ÿï¼ŒåŠ è½½å®ƒçš„ Kernelã€‚Linux ä¸‹æœ‰åçš„ Bootloader æ˜¯ [grub](https://wiki.archlinux.org/index.php/GRUB)ï¼ŒWindows ä¸‹æ˜¯ [winload](https://en.wikipedia.org/wiki/Windows_Vista_startup_process). å…¶å®ï¼ŒBootloader å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œ Linux æ”¯æŒé€šè¿‡ [EFISTUB](https://wiki.archlinux.org/index.php/EFISTUB) ç›´æ¥ä» UEFI å¯åŠ¨ï¼Œä½†è¿™æ ·å°±ä¸æ”¯æŒå¤šç³»ç»Ÿäº†ã€‚

![](images/æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å¯åŠ¨çš„/grub.png)

ä¸Šå›¾å°±æ˜¯ grub çš„ç•Œé¢ï¼Œå¯ä»¥è®©ä½ é€‰æ‹©æ“ä½œç³»ç»Ÿæ¥å¯åŠ¨ï¼ˆç›®å‰åªæœ‰ä¸€ä¸ª [Manjaro](https://manjaro.org/)ï¼‰

## å®‰è£… Arch

å¤§è‡´äº†è§£äº† UEFI å’Œ Bootloader åï¼Œå°±å¯ä»¥å¼€å§‹å®‰è£… Arch äº†ã€‚å®‰è£æ“ä½œç³»çµ±æœ¬è´¨ä¸Šå°±æ˜¯æŠŠæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æ”¾åœ¨æŸä¸ªä½ç½®ï¼ˆå¯ä»¥æ˜¯ç¡¬ç›˜ï¼Œä¹Ÿå¯ä»¥æ˜¯ç½‘ç»œä½ç½®ï¼Œä¸€èˆ¬æ˜¯ç¡¬ç›˜ï¼‰ä¸Šï¼Œåœ¨å‘Šè¯‰ Bootloader å¦‚ä½•å¯åŠ¨è¿™ä¸ªæ“ä½œç³»ç»Ÿã€‚æ‰€ä»¥å¤šç³»ç»Ÿä¹Ÿå¾ˆç®€å•ï¼ŒæŠŠä¸åŒæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æ”¾åœ¨ä¸åŒçš„åˆ†åŒºï¼Œç„¶åéƒ½å‘Šè¯‰ Bootloader è¿™äº›ç³»ç»Ÿåº”è¯¥å¦‚ä½•å¯åŠ¨ï¼Œæˆ‘ä»¬åªè¦åœ¨ grub é‡Œé€‰æ‹©ï¼Œå°±èƒ½åŠ è½½ä¸åŒçš„æ“ä½œç³»ç»Ÿã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œåœ¨è™šæ‹Ÿæœºé‡Œå®‰è£… Arch.

è£…ä¸ª [VirtualBox](https://www.virtualbox.org/), ä¸‹è½½ archlinux çš„[é•œåƒ](https://mirrors.ustc.edu.cn/archlinux/iso/2018.07.01/)ã€‚é…ç½®ä¸€ä¸‹è™šæ‹Ÿæœºï¼Œè®°å¾—å‹¾é€‰ **Settings->System->Enable EFI**ï¼Œä¸ç„¶ä¼šå¯åŠ¨ä¸äº†çš„

> è¯´åœ¨å‰é¢ï¼šå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ ä¸‹è½½çš„ arch iso é•œåƒåªæ˜¯ç»™ä½ ä¸€ä¸ªé¢„å®‰è£…ç¯å¢ƒï¼Œç±»ä¼¼äº [Live CD](https://en.wikipedia.org/wiki/Live_CD) æ¨¡å¼ã€‚æˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸ª Pre-install çš„ç¯å¢ƒä¸‹æŠŠ Arch å®‰è£…åˆ°ç¡¬ç›˜ä¸Šã€‚

### åˆ†åŒº

ä¹‹å‰æåˆ°ï¼Œ UEFI ä¼šå» EFI System Partition(ç®€ç§° ESP) é‡ŒåŠ è½½ Bootloaderï¼ˆæˆ–è€…ç›´æ¥åŠ è½½ Linux Kernelï¼‰ã€‚é‚£é¦–å…ˆï¼Œæˆ‘ä»¬è¦å‡†å¤‡è¿™æ ·ä¸€ä¸ªåˆ†åŒºã€‚é¦–å…ˆçœ‹çœ‹æœ‰æ²¡æœ‰ç°æˆçš„

![](images/æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å¯åŠ¨çš„/df.png)

å¯ä»¥çœ‹å‡ºï¼Œè™šæ‹Ÿæœºæ·»åŠ çš„ç¡¬ç›˜è¿˜æ²¡æœ‰è¢«æŒ‚è½½ã€‚ä½¿ç”¨ fdisk åˆ—å‡ºè™šæ‹Ÿæœºè¿æ¥çš„ç¡¬ç›˜.

![](images/æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å¯åŠ¨çš„/fdisk list.png)

**/dev/sda** å°±æ˜¯æˆ‘ä»¬ä¸ºè™šæ‹Ÿæœºæ·»åŠ çš„ç¡¬ç›˜ï¼Œä½†å¯ä»¥å‘ç°ï¼Œå®ƒè¿˜æ²¡æœ‰åˆå§‹åŒ–ã€‚ä½¿ç”¨ fdisk æ¥ä¸º **/dev/sda** è¿™å—ç¡¬ç›˜åˆ†åŒº

```shell
fdisk /dev/sda
```

æŒ‰ç…§ä¸‹å›¾æ“ä½œ

![](images/æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å¯åŠ¨çš„/fdisk partition.png)

* å‘½ä»¤ `g` å°†åˆ†åŒºè¡¨ç±»å‹æ”¹ä¸º [GPT](https://en.wikipedia.org/wiki/GUID_Partition_Table)
* å‘½ä»¤ `n` åˆ›å»ºä¸€ä¸ªæ–°åˆ†åŒºã€‚è¿™é‡Œåˆ›å»ºäº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€ä¸ªå¤§å° 550M, è®°ä¸º **/dev/sda1**ï¼Œç¬¬äºŒä¸ªå¤§å°ä¸ºå‰©ä¸‹æ‰€æœ‰çš„ç©ºé—´ï¼Œ è®°ä¸º **/dev/sda2**. å¯ä»¥å‘ç°åé¢çš„æ•°å­—ä»£è¡¨åˆ†åŒºå·
* å‘½ä»¤ `t` æ›´æ”¹åˆ†åŒºç±»å‹ã€‚è¿™é‡Œå°† **/dev/sda1** æ”¹æˆäº†æˆ‘ä»¬è¦çš„ ESP åˆ†åŒºï¼Œ550MB æ˜¯ ESP åˆ†åŒºçš„æ¨èå¤§å°
* å‘½ä»¤ `w` ä¿å­˜ä¿®æ”¹å¹¶é€€å‡º
* å‘½ä»¤ `m` æŸ¥çœ‹å¸®åŠ©

### æ ¼å¼åŒ–åˆ†åŒº

```shell
mkfs.fat -F32 /dev/sda1
mkfs.ext4 /dev/sda2
```

ESP é€šå¸¸ä¸º FAT32 æ ¼å¼ï¼ŒLinux åˆ†åŒºé€šå¸¸ä¸º ext4.

### æŒ‚è½½åˆ†åŒº

```shell
mount /dev/sda2 /mnt
mkdir /mnt/boot
mount /dev/sda1 /mnt/boot
```

å°† Linux åˆ†åŒº(sda2) æŒ‚è½½åˆ° /mnt ç›®å½•ï¼ŒæŠŠ ESP åˆ†åŒºæŒ‚è½½åˆ° /mnt/boot ç›®å½•ã€‚

> ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆæŒ‚è½½å‘¢ï¼Ÿ

> æˆ‘ä»¬ç°åœ¨æ‰€å¤„çš„ç¯å¢ƒæ˜¯é¢„å®‰è£…ç¯å¢ƒï¼Œéœ€è¦æŠŠæ“ä½œç³»ç»Ÿæ‰€éœ€çš„æ–‡ä»¶å®‰è£…åˆ° Linux åˆ†åŒº(sda2)ä¸Šï¼ŒæŠŠå¯åŠ¨æ–‡ä»¶å®‰è£…åˆ° ESP åˆ†åŒºä¸Šï¼Œæ‰€ä»¥å…ˆæŒ‚è½½è¿™ä¸¤ä¸ªåˆ†åŒºã€‚å½“ç„¶ï¼Œä½ å¯ä»¥æŠŠ **sda2** æŒ‚è½½åˆ°ä»»ä½•æ–°å»ºçš„ç›®å½•ï¼Œç„¶åå†æŠŠ ESP åˆ†åŒºæŒ‚è½½åˆ°é‚£ä¸ªç›®å½•ä¸‹çš„ boot ç›®å½•ã€‚å› ä¸ºä¸€èˆ¬ ESP åˆ†åŒºéƒ½æ˜¯æŒ‚è½½åˆ° Root Directory ä¸‹çš„ boot æˆ–è€… boot/efi ä¸‹çš„ã€‚

### å®‰è£… base packages

```shell
pacstrap /mnt base
```

[base](https://www.archlinux.org/groups/x86_64/base/) é‡Œå«æœ‰ Linux Kernel, bash, gcc-libs ç­‰åŸºç¡€åŒ…. è¿™æ¡å‘½ä»¤å°±æ˜¯å¾€ **sda2** ä¸Šå®‰è£…æ“ä½œç³»ç»Ÿæ‰€éœ€çš„æ–‡ä»¶ã€‚å¯ä»¥ **ls /mnt** çœ‹ä¸€çœ‹ï¼Œå‘ç°å®ƒå°±æ˜¯ä¸€ä¸ª [Root directory](https://en.wikipedia.org/wiki/Root_directory)

### ç”Ÿæˆ fstab é…ç½®æ–‡ä»¶

```shell
genfstab -U /mnt >> /mnt/etc/fstab
```

fstab é…ç½®æ–‡ä»¶å®šä¹‰äº†å¦‚ä½•æŒ‚è½½åˆ†åŒºåˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç›¸å½“äºæŠŠ mount å‘½ä»¤å›ºåŒ–äº†ã€‚å¯åŠ¨å®‰è£…å¥½çš„ç³»ç»Ÿï¼Œä¼šæ ¹æ®è¿™ä¸ª fstab é…ç½®æ–‡ä»¶æ¥æŒ‚è½½åˆ†åŒºã€‚

### Change root

ç›®å‰æˆ‘ä»¬æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åœ¨ Pre-install ç¯å¢ƒä¸‹çš„ï¼Œç›®å‰çš„ root directory ä¹Ÿæ˜¯ Pre-install ç¯å¢ƒçš„ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æŠŠæ“ä½œç³»ç»Ÿæ‰€éœ€çš„æ–‡ä»¶å®‰è£…åˆ°äº† /mnt ç›®å½•ä¸‹ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå®Œæ•´çš„ Root directory, è€Œæˆ‘ä»¬ç°åœ¨éœ€è¦åœ¨æ–°çš„æ“ä½œç³»ç»Ÿçš„ç¯å¢ƒä¸‹ç»§ç»­é…ç½®ï¼Œè€Œä¸æ˜¯ Pre-install ç¯å¢ƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ¢ Root directory, ç”¨çš„å‘½ä»¤å°±æ˜¯ [chroot](https://wiki.archlinux.org/index.php/Change_root). Arch ä¸ºæˆ‘ä»¬å‡†å¤‡äº† arch-chroot å‘½ä»¤ã€‚

```shell
arch-chroot /mnt
```

é¡ºåˆ©åˆ‡æ¢åˆ°æ–°çš„ Root Directory, ä¹‹å‰ /mnt å˜æˆäº†ç°åœ¨çš„ Root directory. æ¯”å¦‚ï¼Œä¹‹å‰çš„ /mnt/bootï¼Œchange root ä¹‹åï¼Œå°±å˜æˆäº† /bootã€‚æ‰€æœ‰çš„å‘½ä»¤ä¹Ÿæ˜¯æ¥è‡ªæ–°çš„ Root directory.

å¦‚æœä½ ä¹‹å‰ä¸º **sda2** æŒ‚è½½çš„ç›®å½•ä¸æ˜¯ /mnt, è¿™é‡Œæ¢æˆç›¸åº”çš„ç›®å½•å³å¯ã€‚

### Root password

ä¿®æ”¹æ–°ç³»ç»Ÿçš„ root å¯†ç ã€‚åªæœ‰ chroot ä¹‹åæ‰èƒ½æ”¹æ–°ç³»ç»Ÿçš„ root å¯†ç ç­‰å„ç§é…ç½®

```shell
passwd
```


### å®‰è£… Bootloader 

ä»¥ grub ä¸ºä¾‹

```shell
## å®‰è£… grub å’Œ efibootmgt å·¥å…·, pacman æ˜¯ Arch çš„åŒ…ç®¡ç†å·¥å…·ï¼Œç±»ä¼¼äº Ubuntu ä¸‹çš„ apt.
pacman -Sy grub efibootmgr
## grub-install å°† grub å®‰è£…åˆ° /boot æ–‡ä»¶å¤¹ä¸­
grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB
```
çœ‹ä¸€ä¸‹ç”Ÿæˆçš„æ–‡ä»¶

![](images/æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å¯åŠ¨çš„/boot.png)

å…¶ä¸­:

* EFI æ–‡ä»¶å¤¹é‡Œæœ‰ grub çš„ EFI å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒUEFI ä¼šåœ¨è¿™ä¸ªæ–‡ä»¶å¤¹æŸ¥æ‰¾å¹¶æ‰§è¡Œ grubx64.efi æ¥åŠ è½½ grub.
* grub æ–‡ä»¶å¤¹é‡Œæœ‰ grub çš„é…ç½®æ–‡ä»¶ grub.cfg
* **vmlinuz-linux** å°±æ˜¯ linux Kernel, åªä¸è¿‡å®ƒæ˜¯è¢« [zlib](https://en.wikipedia.org/wiki/Zlib) å‹ç¼©è¿‡çš„ï¼Œæ‰€ä»¥æ˜¯ vmlinuzï¼Œç¬‘ã€‚
* initramfs-linux.img å°±æ˜¯å¯åŠ¨æµç¨‹ä¸­çš„ [Early User Space](https://en.wikipedia.org/wiki/Initial_ramdisk)(initrd) é‡Œç”¨åˆ°çš„é•œåƒã€‚

### Bootloader 
çœ‹ä¸€çœ‹ grub çš„é…ç½®æ–‡ä»¶

![](images/æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å¯åŠ¨çš„/grub entry.png)

å¯ä»¥çœ‹åˆ° grub å…ˆåŠ è½½ Kernelï¼Œç„¶åå†åŠ è½½ initramfs-linux.

* Kernel é¦–å…ˆåˆå§‹åŒ–å†…å­˜(åˆ†é¡µ)ï¼ŒCPUï¼Œ[Interrupt](https://en.wikipedia.org/wiki/Interrupt)
* initrd åŠ¨æ€åŠ è½½é©±åŠ¨æ¨¡å—ã€‚å› ä¸ºé©±åŠ¨ç§ç±»ç¹æ‚ï¼ŒæŠŠè¿™äº›é©±åŠ¨åˆ†ç¦»åˆ° initrd ä¸­çš„ initramfs-linux.img å¯ä»¥æœ‰æ•ˆå‡å°‘ Kernel çš„å¤§å°ã€‚è¿™ä¸€æ­¥ä¼šåˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ root directory æ¥æ‰§è¡Œå‘½ä»¤ï¼Œå®Œæˆä¹‹åï¼Œä¼šåˆ‡æ¢åˆ°çœŸæ­£çš„ root directory. è¯¦è§ [Initial ramdisk](https://en.wikipedia.org/wiki/Initial_ramdisk)
* Kernel åˆå§‹åŒ–è®¾å¤‡ï¼Œå¼€å§‹ Init Process, è¿›å…¥ User Space.
* Init Process æ˜¯æ“ä½œç³»ç»Ÿæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼ŒPID ä¸º1ã€‚å®ƒè´Ÿè´£å¯åŠ¨æ‰€æœ‰çš„è¿›ç¨‹ï¼Œå› æ­¤å®ƒæ˜¯æ‰€æœ‰è¿›ç¨‹çš„ç›´æ¥æˆ–é—´æ¥çˆ¶è¿›ç¨‹ã€‚[SysV init](https://en.wikipedia.org/wiki/Init) å’Œ [Systemd](https://en.wikipedia.org/wiki/Systemd) æ˜¯å¸¸è§çš„ä¸¤ç§ Init Process. SysV init æ˜¯åŸºäº Shell Script çš„(æƒ³å¿…å¤§å®¶æœ‰å¾€ /etc/rc ä¸­æ·»åŠ è„šæœ¬æ¥è®¾ç½®åº”ç”¨è‡ªå¯çš„ç»å†)ï¼Œè€Œä¸”æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œå¯æƒ³è€ŒçŸ¥å¯åŠ¨é€Ÿåº¦ä¼šå¾ˆæ…¢ï¼Œå› æ­¤ç°åœ¨å¾ˆå¤šå‘è¡Œç‰ˆå·²ç»ä¸æŠŠ SysV init ä½œä¸º Init Process äº†ã€‚Systemd æ˜¯ä¸ºäº†è§£å†³ init çš„é—®é¢˜è€Œç”Ÿçš„, å®ƒä½¿ç”¨å£°æ˜å¼çš„é…ç½®æ–‡ä»¶ï¼Œæé«˜äº†å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼›å®ƒæ”¯æŒå¹¶è¡Œæ‰§è¡Œï¼Œå¤§å¤§åŠ å¿«äº†å¯åŠ¨é€Ÿåº¦ã€‚ç°åœ¨ï¼Œä¸»æµçš„ Linux å‘è¡Œç‰ˆéƒ½é‡‡ç”¨äº† Systemd ä½œä¸º Init Process. æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç«  [Rethinking PID 1](http://0pointer.de/blog/projects/systemd.html) æ¥äº†è§£ Systemd çš„èµ·æºã€‚

![](images/æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å¯åŠ¨çš„/Systemd_components.png)

ä¸Šå›¾æ˜¯ Tizen ç³»ç»Ÿä¸­çš„ Systemd, å¯ä»¥å‘ç° systemd ä¸ä»…åªåš Init åˆå§‹åŒ–ï¼Œè¿˜æä¾›æ—¥å¿—ã€ç½‘ç»œã€cgroup èµ„æºæ§åˆ¶ç­‰ã€‚

* Systemd å¯åŠ¨ [getty](https://en.wikipedia.org/wiki/Getty_(Unix))ï¼Œç”¨æˆ·è¾“å…¥ username å’Œ passwordï¼Œè°ƒç”¨ **login**, éªŒè¯é€šè¿‡ä¹‹åï¼Œæ ¹æ® **/etc/passwd** æ¥ä¸ºè¯¥ç”¨æˆ·å¯åŠ¨ç›¸åº”çš„ shell(e.g. bash and zsh)ï¼Œshell åŠ è½½ç”¨æˆ·çš„é…ç½®æ–‡ä»¶(e.g. bashrc and zshrc)ä¸ºç”¨æˆ·åˆå§‹åŒ–ç¯å¢ƒã€‚

### å®Œæˆå®‰è£…

```shell
## å®Œæˆ grub çš„å®‰è£…åï¼Œé€€å‡ºå½“å‰çš„ change root ç¯å¢ƒ
exit
## é‡å¯ç”µè„‘
reboot
```

## æ€»ç»“

Linux æ“ä½œç³»ç»Ÿå¯åŠ¨æµç¨‹ä¸»è¦åˆ†ä»¥ä¸‹å‡ æ­¥: ä¸»æ¿ä¸Šçš„ UEFI åŠ è½½ ESP åˆ†åŒºä¸­çš„ Bootloader; Bootloader åŠ è½½ Linux Kernel å’Œ Initrd; Kernel åˆå§‹åŒ–å†…å­˜ç®¡ç†ã€CPUã€ä¸­æ–­ã€è®¾å¤‡ç­‰ï¼ŒInitrd åŠ è½½è®¾å¤‡é©±åŠ¨æ¨¡å—; Kernel å¯åŠ¨ Systemd æ¥åˆå§‹åŒ– User Space çš„åº”ç”¨ã€‚

Windows å’Œ macOS ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæ— éæ˜¯ Bootloader çš„åå­—ä¸ä¸€æ ·ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸ä¸€æ ·ï¼Œå¯åŠ¨çš„æµç¨‹ç•¥æœ‰å·®åˆ«è€Œå·²ã€‚å½“ç„¶, grub ä¹Ÿå¯ä»¥å¼•å¯¼ Windowsï¼Œåªè¦ Windows çš„ EFI æ–‡ä»¶åœ¨ ESP åˆ†åŒºï¼ŒåŒæ—¶ grub.cfg é‡Œæœ‰é…ç½® entry å°±è¡Œã€‚å½“ç„¶ï¼Œè‹¥çœŸè¦å®‰è£…åŒç³»ç»Ÿï¼Œä¹Ÿä¸ç”¨æ‰‹åŠ¨æ•²è¿™ä¹ˆå¤šå‘½ä»¤çš„ï¼Œç°åœ¨å¾ˆå¤šå‘è¡Œç‰ˆä¼šå¸®ä½ æå®šä¸€åˆ‡çš„ï¼Œäº†è§£ä¸€äº›åŸç†ä¸Šçš„ä¸œè¥¿ï¼Œä¸å®¹æ˜“çŠ¯é”™ã€‚

## One more thing

```shell
## æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
journalctl --boot
## å­¦ä¹ ä¸€ä¸‹ Systemd çš„ç›®å½•ç»“æ„
systemd-path
```

æœ€åï¼Œ å®‰è£…å¥½çš„ Arch è¿˜è¦ç»è¿‡ä¸€ç³»åˆ—é…ç½®ä¹‹åæ‰èƒ½ä½¿ç”¨ï¼ˆæ¯•ç«Ÿç½‘ç»œéƒ½ä¸å¯ç”¨ğŸ¤£ï¼‰ï¼Œåœ¨æ­¤ä»…ä¸ºé˜è¿° Linux å¯åŠ¨æµç¨‹.

## å‚è€ƒ

* [ArchLinux Installation guide](https://wiki.archlinux.org/index.php/Installation_guide)
* [Arch boot process](https://wiki.archlinux.org/index.php/Arch_boot_process)
* [GRUB](https://wiki.archlinux.org/index.php/GRUB#UEFI_systems)
* [Linux startup process](https://en.wikipedia.org/wiki/Linux_startup_process)
* [Initial ramdisk](https://en.wikipedia.org/wiki/Initial_ramdisk)
